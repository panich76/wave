<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installer</title>
    <!-- https://play.tailwindcss.com/jsgax5UmBg -->
    <style>a,hr{color:inherit}progress,sub,sup{vertical-align:baseline}blockquote,body,dd,dl,fieldset,figure,h1,h2,h3,h4,h5,h6,hr,menu,ol,p,pre,ul{margin:0}dialog,fieldset,legend,menu,ol,ul{padding:0}*,::after,::before{box-sizing:border-box;border:0 solid #e5e7eb;--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{line-height:inherit}hr{height:0;border-top-width:1px}abbr:where([title]){text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}menu,ol,ul{list-style:none}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.hidden,[hidden]{display:none}::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.container,.w-full{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.bottom-0{bottom:0}.left-0{left:0}.top-0{top:0}.z-10{z-index:10}.z-20{z-index:20}.z-30{z-index:30}.block{display:block}.flex{display:flex}.table{display:table}.h-1{height:.25rem}.h-1\/2{height:50%}.h-full{height:100%}.h-px{height:1px}.h-screen{height:100vh}.w-1{width:.25rem}.w-1\/2{width:50%}.w-screen{width:100vw}.resize{resize:both}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.overflow-hidden{overflow:hidden}.overflow-y-scroll{overflow-y:scroll}.rounded-xl{border-radius:.75rem}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0 / var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.bg-opacity-20{--tw-bg-opacity:0.2}.p-5{padding:1.25rem}.pb-3{padding-bottom:.75rem}.pb-3\.5{padding-bottom:.875rem}.pl-5{padding-left:1.25rem}.pt-10{padding-top:2.5rem}.pt-16{padding-top:4rem}.pt-4{padding-top:1rem}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}.font-sans{font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity))}.opacity-10{opacity:.1}.opacity-\[15\%\]{opacity:15%}.outline{outline-style:solid}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}</style>
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <style>
        #container {
            scroll-behavior: smooth;
        }
    </style>
    <script>
        function scrollToBottom() {
            const container = document.getElementById('container');
            container.scrollTop = container.scrollHeight;
        }

        function addParagraph(content) {
            const container = document.getElementById('container');
            const newParagraph = document.createElement('p');
            newParagraph.innerHTML = content;
            container.appendChild(newParagraph);
            scrollToBottom();
        }
    </script>
</head>
<body class="flex overflow-hidden relative flex-col justify-start items-start w-screen h-screen bg-black">
    <p class="block fixed top-0 z-30 pt-4 pb-3.5 pl-5 w-full font-sans text-xs font-bold text-white bg-black bg-opacity-20 backdrop-blur-sm">Installing Composer Dependencies<span class="absolute bottom-0 left-0 w-screen h-px bg-white opacity-10"></span></p>
    <div class="flex fixed inset-0 z-10 justify-center items-center w-screen h-screen">
        <svg class="fixed z-10 w-1/2 h-1/2 text-white opacity-[15%]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 99 100" height="100" fill="none"><path fill="currentColor" d="M53.878 92.36V75.02h2.046c2.66 0 5.296-.532 7.753-1.563a20.201 20.201 0 0 0 6.566-4.448 20.432 20.432 0 0 0 4.403-6.633 20.598 20.598 0 0 0 1.549-7.831c0-4.822.024-9.456.024-14.257h2.858l-3.474-6.077-.066-.115-3.648-6.381-1.57 2.746a40.199 40.199 0 0 1 4.843 3.4 40.957 40.957 0 0 0-4.87-3.409l-3.94 6.894.024.015-1.781 3.117h3.713v14.067a12.577 12.577 0 0 1-.948 4.782 12.477 12.477 0 0 1-2.693 4.05 12.338 12.338 0 0 1-4.008 2.72c-1.5.63-3.11.956-4.735.957h-2.046v-34c1.193.142 2.376.354 3.545.634l-5.01-8.766-1.998-3.494-.48-.838-1.238 2.166-1.238 2.166.383-.021-.384.023-5.014 8.772a31.723 31.723 0 0 1 3.548-.643v34.001h-2.045a12.238 12.238 0 0 1-4.735-.958 12.34 12.34 0 0 1-4.009-2.72 12.475 12.475 0 0 1-2.692-4.049 12.575 12.575 0 0 1-.949-4.782V40.477h2.95l-1.583-2.77-3.944-6.9-1.767-3.092-3.648 6.381-.87 1.521v.001l-1.126 1.094c.368-.372.744-.737 1.127-1.094l-2.778 4.86h3.754v14.067c0 2.688.526 5.349 1.548 7.831a20.43 20.43 0 0 0 4.403 6.633 20.196 20.196 0 0 0 6.566 4.448 20.03 20.03 0 0 0 7.753 1.563h2.045v24.855c1.159.082 2.328.124 3.508.125a48.92 48.92 0 0 0 18.948-3.795A49.32 49.32 0 0 0 84.5 85.355a49.882 49.882 0 0 0 10.742-16.216A50.282 50.282 0 0 0 99 50a50.285 50.285 0 0 0-3.757-19.14 49.884 49.884 0 0 0-10.742-16.215 49.318 49.318 0 0 0-16.053-10.85A48.918 48.918 0 0 0 49.5 0a48.92 48.92 0 0 0-18.948 3.794 49.32 49.32 0 0 0-16.054 10.85A49.883 49.883 0 0 0 3.757 30.861 50.285 50.285 0 0 0 0 50a50.282 50.282 0 0 0 3.757 19.139 49.881 49.881 0 0 0 10.741 16.216 49.291 49.291 0 0 0 23.666 13.327v-7.654a42.035 42.035 0 0 1-18.477-10.915 42.485 42.485 0 0 1-9.149-13.812A42.827 42.827 0 0 1 7.34 50a42.831 42.831 0 0 1 3.2-16.302 42.487 42.487 0 0 1 9.148-13.812 42.009 42.009 0 0 1 13.675-9.242A41.668 41.668 0 0 1 49.5 7.413a41.666 41.666 0 0 1 16.138 3.232 42.008 42.008 0 0 1 13.674 9.24 42.489 42.489 0 0 1 9.15 13.813A42.83 42.83 0 0 1 91.662 50a42.827 42.827 0 0 1-3.2 16.301 42.487 42.487 0 0 1-9.15 13.812C72.482 87.03 63.5 91.354 53.878 92.36Zm-2.513-67.49.273.012h-.006l-.267-.011Z"></path></svg>
    </div>
    <div class="overflow-y-scroll relative z-20 p-5 pt-16 w-full h-screen font-mono text-xs text-white rounded-xl" id="container">
            
        <?php

            if ($os == 'Windows') {
                $outputFile = $projectRoot . '\output.txt';
                while (!file_exists($outputFile)) {
                    usleep(100000); // Wait until the output file is created
                }
                $fp = fopen($outputFile, 'r');
                while (!feof($fp)) {
                    $output = fgets($fp);
                    if ($output !== false) {
                        echo '<script>addParagraph(' . json_encode(nl2br(htmlspecialchars($output))) . ');</script>';
                        flush(); // Ensure the output is sent to the browser immediately
                    }
                    usleep(100000); // Slight delay to reduce CPU usage
                }
                fclose($fp);
                unlink($outputFile); // Clean up the output file
            } else {
                // Check if the process was opened successfully
                if (is_resource($process)) {
                    // Stream the output in real-time
                    while (!feof($process)) {
                        $output = fread($process, 4096);
                        echo '<script>addParagraph(' . json_encode(nl2br(htmlspecialchars($output))) . ');</script>';
                        flush(); // Ensure the output is sent to the browser immediately
                    }

                    // Close the process
                    $returnVar = pclose($process);
                }
            }

            sleep(3);

            // Check for errors
            if (isset($returnVar) && $returnVar !== 0) {
                http_response_code(500);
                echo "<p class='text-red-500'>Composer install failed. Please make sure you meet the minimum requirements</p>";
                exit(1);
            }

        ?>
        <script>
            window.location.href = '/install';
        </script>
    </div>
</body>
</html>